<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/blog/pico.min.css">
  <link rel="stylesheet" href="/blog/index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">
  <script defer="" src="/blog/js/katex.min.js" integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous"></script>
  <script defer="" src="/blog/js/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
  <link rel="stylesheet" href="/blog/dracula.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/fortran.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/julia.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/c.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/haskell.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/perl.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js"></script>
  <script>
   hljs.highlightAll();
  </script>
 </head>
 <body>
  <main>
   <h1>
    Buzzword
   </h1>
   <summary>
    <p>
     <strong>11 November 2022</strong>
    </p>
    <p>
     The timeline of my experience at Durhack
    </p>
   </summary>
   <h1>
    10:39 - The beginning
   </h1>
   <p>
    Today I’m taking part in <a href="https://durhack.com/">Durhack</a>,
the <a href="https://durham.ac.uk/">Durham University</a> Hackathon and
I’m determined to make the dumbest project at the hackathon. My vague
idea is a project with the name of <em>Buzzword</em>. It’s a
distributed-first, scalable programming language with built-in automatic
differentiation for Machine Learning on the Blockchain. Yup.
   </p>
   <h1>
    10:53 - The group that uses Rust
   </h1>
   <p>
    I have just met a group being led by a Rust programmer, the rest of
the group is new to Rust. I inquire about this and remark that it takes
a <em>lifetime</em> (pun-intended) to understand the Rust
borrow-checker.
   </p>
   <h1>
    10:57 - Doubly linked lsits
   </h1>
   <p>
    Today I learned about Doubly Linked Lists in Rust. Gnarly.
   </p>
   <div class="sourceCode" id="cb1">
    <pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::rc::</span>Rc<span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::cell::</span>RefCell<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> List<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    head<span class="op">:</span> Link<span class="op">&lt;</span>T<span class="op">&gt;,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    tail<span class="op">:</span> Link<span class="op">&lt;</span>T<span class="op">&gt;,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Link<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">=</span> <span class="dt">Option</span><span class="op">&lt;</span>Rc<span class="op">&lt;</span>RefCell<span class="op">&lt;</span>Node<span class="op">&lt;</span>T<span class="op">&gt;&gt;&gt;&gt;;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Node<span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    elem<span class="op">:</span> T<span class="op">,</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    next<span class="op">:</span> Link<span class="op">&lt;</span>T<span class="op">&gt;,</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    prev<span class="op">:</span> Link<span class="op">&lt;</span>T<span class="op">&gt;,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre>
   </div>
   <h1>
    11:04 - A profound realisation
   </h1>
   <p>
    I realise that if I spend my entire time writing about Durhack, I
will not have time to do any programming.
   </p>
   <h1>
    11:06 - The introductory talk commences
   </h1>
   <h1>
    12:03 - A smart idea
   </h1>
   <p>
    I decide to stop writing and start programming.
   </p>
   <h1>
    12:04 - Scratch that
   </h1>
   <p>
    I realise that I need to program in Solidity, but I do not know how
to program in solidity. <em>But</em> I have 24 hours to work this out, I
think.
   </p>
   <h1>
    12:05 - Intermission
   </h1>
   <p>
    I will see if I can find any food and after that I will start
programming, <em>I promise</em>.
   </p>
   <h1>
    12:08 - Disappointment
   </h1>
   <p>
    I have been informed that the Subway order has been delayed. I will
begin programming albeit hungry and a bit sad.
   </p>
   <h1>
    12:18 - I need a plan
   </h1>
   <p>
    I think the most important part of this project is getting machine
learning done on the blockchain. So I’ve made the decision to postpone
the language implementation until later.
   </p>
   <p>
    I started defining the necessary data types to build an API for
Neural Networks but I’m wondering if I even need to do this. My idea is
that I can start with classical Machine Learning techniques and
potentially add Neural Networks if I have time. My only concern with
Neural networks is the backpropogation step, I want to keep my project
simple so I don’t make a mistake and spend more time debugging.
   </p>
   <p>
    I’ll keep the API in a separate file but I’ll focus my efforts on
getting a proof of concept first.
   </p>
   <h1>
    12:33 - Another realisation
   </h1>
   <p>
    I am learning Solidity at the same time as building a relatively
non-trivial project in it. I am currently working out how to read an
array of integers from a string.
   </p>
   <h1>
    12:53 - Progress??
   </h1>
   <p>
    I am learning a lot about solidity and I think I’ve just read a list
of integers from a string?? My code compiles, which I did not
expect.
   </p>
   <h1>
    12:57 - ???
   </h1>
   <p>
    I feel like a Boomer. I think I just deployed some code to the
blockchain?
   </p>
   <h1>
    12:59 - ?????
   </h1>
   <p>
    I ran my code and it did not error?
   </p>
   <h1>
    13:00 - Progress!
   </h1>
   <p>
    I can read strings into integer arrays and store them on the
blockchain! It only took 27 minutes, 66 lines of code and countless
lookups to the solidity reference document.
   </p>
   <pre class="solidity"><code>pragma solidity ^0.8.7;

contract Buzzword {
    bytes1 constant ZERO = '0';
    bytes1 constant NINE = '9';
    int[] xs;
    int[] ys;
    int[] work;
    function loadData(string memory xstring, string memory ystring) public payable  {
        bytes memory xbytes = bytes(xstring);
        bytes memory ybytes = bytes(ystring);

        // Work on the assumption that there is at least one item in the arrays
        xs = readIntegerArray(xbytes);
        ys = readIntegerArray(ybytes);
    }

    function testXsContainsData() public view returns (int) {
        return xs[0];
    }

    function readIntegerArray(bytes memory bArray) private returns (int[] memory){
        work = new int[](0);
        
        // Work out how many numbers there are 
        uint numIntegers = 0; 
        for (uint index = 0; index &lt; bArray.length; index++) {
            if (bArray[index] == ";") {
                numIntegers++;
            }
        }

        // The beginning of the number begins at 
        uint bArrayIndex = 0;
        for (uint index = 0; index &lt; numIntegers; index++) {
            // Read the sign
            int sign;
            if (bArray[bArrayIndex] == "+") {
                sign = 1;
            }
            else if (bArray[bArrayIndex] == "-") {
                sign = -1;
            }
            else {
                require(false);
            } 
            // Increment the string index   
            bArrayIndex++;


            uint number;
            // Read numbers until the termination character
            while (bArray[bArrayIndex] != ";") {
                number *= 10;
                bytes1 digitByte = bArray[bArrayIndex];
                require(ZERO &lt;= digitByte &amp;&amp; digitByte &lt;= NINE);
                uint8 digitValue = uint8(digitByte) - uint8(ZERO);
                number += digitValue;
                bArrayIndex++;
            }
            work.push(int(number) * sign);
        }

        return work;
    }
}</code></pre>
   <p>
    I am not looking forward to implementing any sort of machine
learning.
   </p>
   <h1>
    13:06 - Problems
   </h1>
   <p>
    I will probably want to perform Machine Learning on datasets where
the data contains more than a singular integer feature. I can read an
array of integers but I will probably want to read arrays of tuples of
integers. But I can worry about this later.
   </p>
   <h1>
    13:14 - The state of my browser tabs
   </h1>
   <p>
    I currently have 17 solidity-related browser tabs open and because I
am not a heathen, this makes me anxious.
   </p>
   <p>
    <img src="https://i.imgur.com/IEriCna.png">
   </p>
   <h1>
    13:15 - Basic machine learning
   </h1>
   <p>
    I think I’ll take a small break before I start with something small.
My plan is to build a linear regression model and train it using
gradient descent.
   </p>
   <h1>
    13:22 - Getting started
   </h1>
   <p>
    Break over. Machine Learning time.
   </p>
   <h1>
    13:39 - Lunch
   </h1>
   <p>
    I re-started my break and ate Durhack-provisioned <a href="https://www.subway.com/">Subway</a>. I rate the food quite highly,
I was satisfied.
   </p>
   <h1>
    13:48 - Pain
   </h1>
   <p>
    It would be really usefuly if solidity had a library for automatic
differentiation. It is starting to feel like the language wasn’t made
for machine learning. I’m taking a break and I will think about my plan
moving forward.
   </p>
   <h1>
    14:02 - Thoughts
   </h1>
   <p>
    I know from my econometrics book that the OLS estimate for the
univariate model, (Y = \beta_0 + \beta_1 X) takes on the following
form.
   </p>
   <p>
    \[ \begin{align} \beta_0 &amp;= \bar{X} \\ \beta_1 &amp;=
\frac{\text{Cov}(X, Y)}{\text{Var}(X)} \end{align} \]
   </p>
   <p>
    For now I will use this shortcut and potentially move onto gradient
descent later. There are many similar shortcuts like this since I can
use references to find the derivatives for some common loss and
activation functions.
   </p>
   <h1>
    14:06 - Pain
   </h1>
   <p>
    Solidity does not support floating point numbers. This is
disasterous.
   </p>
   <h1>
    14:18 - Acceptance
   </h1>
   <p>
    I have sped-run the <a href="https://en.wikipedia.org/wiki/Five_stages_of_grief">stages of
grief</a> and I am embracing fixed-point arithmetic. What could go
wrong.
   </p>
   <h2>
    An aside
   </h2>
   <p>
    I had two ideas of re-implementing floating point arithmetic in
Solidity or creating a rational number datatype and implementing the
arithmetic operations myself. There are also some libraries for floating
point arithmetic in Solidity so I am considering potentially using those
in the future.
   </p>
   <h1>
    14:21 - Disaster
   </h1>
   <p>
    Solidity does not actually support fixed-point arithmetic. The
language documentation states that fixed-point numbers can be declared
but cannot be assigned to. This is horrific.
   </p>
   <h1>
    14:24 - Weighing up my options
   </h1>
   <p>
    I now have a few options. I can use a hardened and tested library for
floating-point arithmetic in Solidity which would make my life easier
<em>or</em> I could create a hack to represent rational numbers.
   </p>
   <p>
    \[ \dots \]
   </p>
   <h1>
    14:25 - Rational numbers
   </h1>
   <p>
    So, I can represent a rational number as a pair of integers
   </p>
   <p>
    \[ \mathbb Q := \{ (p, q) : p, q \in \mathbb Z \} \]
   </p>
   <p>
    Define equality as the following relation
   </p>
   <p>
    \[ R = \{\left&lt;(p_1, q_1), (p_2, q_2)\right&gt; : p_1 q_2 = q_1
p_2\} \]
   </p>
   <p>
    The reader can verify that this indeed defines an equivalence
relation and returns expected results.
   </p>
   <p>
    It is currently 14:31 so I won’t spend time formalising my
construction but the definition of addition and multiplication comes
naturally if you interpret \((p, q)\) as representing the fraction
\(\frac{p}{q}\).
   </p>
   <h1>
    15:09 - ???
   </h1>
   <p>
    I went to test my linear regression code. Loading the values worked
fine after I fixed a bug (try and find it in the code above!) but when I
ran the code to train the model, the Remix IDE crashed.
   </p>
   <h1>
    15:21 - Trying again, minor fixes
   </h1>
   <p>
    So I tried running the linear regression with smaller values, the IDE
didn’t crash and the machine <em>did</em> in fact learn but it had
learned the function \(y = 2\) for the data \(X = [1, 2, 3], Y = [3, 5,
8]\). Immediately I was able to spot some minor bugs in my code. There’s
actually a glaring major mistake in what I wrote above for the OLS
estimate for \(\beta_0\). And secondly, I made an subtle error in my
training code where I trained a model to predict \(X\) using as the
predictor \(X\). There was also another mistake where I calculated the
variance wrong and another mistake where I
   </p>
   <p>
    \[ \dots \]
   </p>
   <h1>
    15:46 - More problems
   </h1>
   <p>
    Firstly, the Remix IDE appears to be very prone to crashing. I keep
getting the following error.
   </p>
   <pre><code>[21067:1119/154525.567488:ERROR:v8_initializer.cc(714)] V8 javascript OOM (Reached heap limit).</code></pre>
   <p>
    Note that this is almost entirely my fault. My implementation of the
Rational numbers is extremely inefficient. And I create new rationals
for every operation I complete.
   </p>
   <h1>
    15:56 - …
   </h1>
   <p>
    I have sat here poking at my code for 10 minutes and I don’t think I
can do anything about having the world’s worst replacement for floating
point numbers. I’m very close to a proof of concept, the smart contract
loads the data, trains the model then runs out of memory during the
prediction step.
   </p>
   <h1>
    16:09 - A terrible mistake
   </h1>
   <p>
    I’ve been calculating the covariance wrong. Just entirely wrong. I
tried to make an optimisation but it was just not correct. Essentially I
calculated the following
   </p>
   <p>
    \[ \sum_ {i = 1}^ n \frac{(x_i - y_i)^2}{n} \]
   </p>
   <p>
    I actually want the following
   </p>
   <p>
    \[ \sum_ {i=1}^n \frac{(x - \bar{x}_i)(y-\bar{y}_i)}{n} \]
   </p>
   <h1>
    16:19 - Success!
   </h1>
   <p>
    I gave Buzzword the data ((X = [1, 2], Y = [2, 4])), I then asked it
to train the linear regression model. I gave it the value 1 and asked it
to predict a result and it returned 2. Nice!
   </p>
   <p>
    I gave it 2 and asked it to predict a result and it returned 4.
Cool!
   </p>
   <p>
    I gave it 3 and asked it to predict a result and it returned 6.
Awesome!
   </p>
   <p>
    I checked the internals and it has learned the function \(Y = 2X\) or
more precisely \(Y = \frac{0}{262144} + \frac{32768}{16384}X\) which
computes the same function.
   </p>
   <p>
    Here’s my code so far.
   </p>
   <pre class="solidity"><code>pragma solidity ^0.8.7;

contract Buzzword {
    bytes1 constant ZERO = '0';
    bytes1 constant NINE = '9';
    int[] xs;
    int[] ys;
    int[] work;
    int result;
    
    Rational linearRegressionBias;
    Rational linearRegressionWeight;

    struct Rational {
        int p;
        int q;
    }

    function rationalEquals(Rational memory left, Rational memory right) private returns (bool) {
        return left.p * right.q == left.q * right.p;
    }

    function rationalAdd(Rational memory left, Rational memory right) private returns (Rational memory) {
        return Rational(left.p * right.q + right.p * left.q, left.q * right.q);
    }

    function rationalNegate(Rational memory rational) private returns (Rational memory) {
        return Rational(-rational.p, rational.q);
    }

    function rationalSubtract(Rational memory left, Rational memory right) private returns (Rational memory) {
        return rationalAdd(left, rationalNegate(right));
    }

    function rationalMultiply(Rational memory left, Rational memory right) private returns (Rational memory) {
        return Rational(left.p * right.p, left.q * right.q);
    }

    function rationalSquare(Rational memory rational) private returns (Rational memory) {
        return rationalMultiply(rational, rational);
    }

    function rationalInvert(Rational memory rational) private returns (Rational memory) {
        return Rational(rational.q, rational.p);
    }

    function rationalDivide(Rational memory left, Rational memory right) private returns (Rational memory) {
        return rationalMultiply(left, rationalInvert(right));
    }

    function normalise (Rational memory rational) private returns (Rational memory) {
        return Rational(rational.p / rational.q, 1);
    }

    function integerToRational (int number) private returns (Rational memory) {
        return Rational(number, 1);
    }

    function uintegerToRational (uint number) private returns (Rational memory) {
        return integerToRational(int(number));
    }

    function leastSquaresLoss (int[] memory yacc, int[] memory yhat) private returns (Rational memory) {
        require(ys.length == yhat.length);
        Rational memory n = uintegerToRational(ys.length);
        Rational memory loss = integerToRational(0);
        for (uint index = 0; index &lt; ys.length; index++) {
            Rational memory actual = integerToRational(yacc[index]);
            Rational memory predicted = integerToRational(yhat[index]);
            Rational memory deviation = rationalSubtract(actual, predicted);
            loss = rationalAdd(loss,
                rationalDivide(
                    rationalSquare(deviation),
                    n
                )
            );
        }
        return loss;
    }

    function trainLinearRegressionModelWithOls() public {
        Rational memory Y_bar = integerToRational(0);
        Rational memory X_bar = integerToRational(0);
        Rational memory X_squared_bar = integerToRational(0);

        Rational memory B1;
        Rational memory B0;

        Rational memory Cov_XY = integerToRational(0);

        require(xs.length == ys.length);
        // Calculate B0 = X_bar
        // And B1 = Cov(X, Y)/Var(X)
        Rational memory n = uintegerToRational(xs.length);
        for (uint index = 0; index &lt; xs.length; index++) {
            // Contributing to the mean of X
            Rational memory x = integerToRational(xs[index]);
            Rational memory y = integerToRational(ys[index]);

            X_squared_bar = rationalAdd(
                X_squared_bar,
                rationalDivide(rationalSquare(x), n)
            );

            X_bar = rationalAdd(
                X_bar,
                rationalDivide(x, n)
            );

            Y_bar = rationalAdd(
                Y_bar,
                rationalDivide(y, n)
            );
        }

        for (uint index = 0; index &lt; xs.length; index++) {
            Rational memory x = integerToRational(xs[index]);
            Rational memory y = integerToRational(ys[index]);
            Rational memory contribution = rationalDivide(
                    rationalMultiply(
                        rationalSubtract(x, X_bar),
                        rationalSubtract(y, Y_bar)
                    ),
                    n
                );
            Cov_XY = rationalAdd(
                Cov_XY,
                contribution  
            );
        }

        // Calculate the variance of X
        Rational memory Var_X = rationalSubtract(X_squared_bar, rationalSquare(X_bar)); 

        B1 = rationalDivide(Cov_XY, Var_X);
        B0 = rationalSubtract(
            Y_bar,
            rationalMultiply(B1, X_bar)
        );

        linearRegressionBias = B0;
        linearRegressionWeight = B1;
    }

    function predict(int x) public payable {
        result = normalise(
            rationalAdd(
                linearRegressionBias,
                rationalMultiply(
                    linearRegressionWeight,
                    integerToRational(x)
                )
            )
        ).p;
    }

    function predictionResult() public view returns (int) {
        return result;
    }

    function loadData(string memory xstring, string memory ystring) public payable  {
        bytes memory xbytes = bytes(xstring);
        bytes memory ybytes = bytes(ystring);

        // Work on the assumption that there is at least one item in the arrays
        xs = readIntegerArray(xbytes);
        ys = readIntegerArray(ybytes);
    }

    function testXsContainsData() public view returns (int) {
        return xs[0];
    }

    function readIntegerArray(bytes memory bArray) private returns (int[] memory){
        work = new int[](0);
        
        // Work out how many numbers there are 
        uint numIntegers = 0; 
        for (uint index = 0; index &lt; bArray.length; index++) {
            if (bArray[index] == ";") {
                numIntegers++;
            }
        }

        // The beginning of the number begins at 
        uint bArrayIndex = 0;
        for (uint index = 0; index &lt; numIntegers; index++) {
            // Read the sign
            int sign;
            if (bArray[bArrayIndex] == "+") {
                sign = 1;
            }
            else if (bArray[bArrayIndex] == "-") {
                sign = -1;
            }
            else {
                require(false);
            }
            // Increment the string index   
            bArrayIndex++;


            uint number;
            // Read numbers until the termination character
            while (bArray[bArrayIndex] != ";") {
                number *= 10;
                bytes1 digitByte = bArray[bArrayIndex];
                require(ZERO &lt;= digitByte &amp;&amp; digitByte &lt;= NINE);
                uint8 digitValue = uint8(digitByte) - uint8(ZERO);
                number += digitValue;
                bArrayIndex++;
            }
            // Skip the final termination symbol
            bArrayIndex++;
            work.push(int(number) * sign);
        }

        return work;
    }
}</code></pre>
   <h1>
    16:45 - A pretty picture
   </h1>
   <p>
    I spent 20 minutes making this graph to explain what Buzzword has
done. I am so proud of my creation.
   </p>
   <img src="https://i.imgur.com/NA3uWzo.png">
   <h1>
    18:04 - Break over
   </h1>
   <p>
    I’ve just finished an hour break. I’m going to make a promotional
webpage.
   </p>
   <h1>
    18:07 - Another project?
   </h1>
   <p>
    I found the following [1] blog post a few days ago that used the
Salesforce CodeGen model to predict the probability that a specific
token follows given the previous sequence of text. The model determined
that the probability of the <code>return</code> appearing in the context
that it did was low, correctly inferring that there was a bug. This gave
me the idea of building a tool like Grammarly but for your code. The
author doesn’t detail how they did it, but I can work it out.
   </p>
   <ol type="1">
    <li>
     <a href="https://joel.tools/codegen/">AI Found a Bug in My Code</a>,
<em>Joel Einbinder</em>
    </li>
   </ol>
   <h1>
    19:17 - A difficulty
   </h1>
   <p>
    My measly 24.9GB of RAM and swap is not enough to run the Salesforce
Codegen model. This is a problem.
   </p>
   <h1>
    19:19 - My options
   </h1>
   <p>
    I can either use a smaller model or I can use Google Colab to run
computation then export the results to an external application that I’ll
create. I prefer the latter idea.
   </p>
   <h1>
    19:37 - Another idea??
   </h1>
   <p>
    I had the idea that I can simulate a <a href="https://en.wikipedia.org/wiki/Turing_machine">Turing machine</a>
using GitHub actions with a new commit generated for every step of
computation. I like this idea because it is stupid and there is also a
prize for the best use of GitHub. I think I’ll enter as a
contestant.
   </p>
   <h1>
    19:44 - GitHub repository created
   </h1>
   <p>
    My GitHub repository is live at <a href="https://github.com/dignissimus/github-actions-turing-machine/tree/master">https://github.com/dignissimus/github-actions-turing-machine/</a>
   </p>
   <h1>
    19:51 - Deciding on the structure of the project
   </h1>
   <p>
    So I want to store the definition of the turing machine somewhere
which should be ok. Then I also need to store the state of the turing
machine. I left my Theory of Computation books at home but I should be
good using Wikipedia as a reference.
   </p>
   <h1>
    19:53 - Another realisation
   </h1>
   <p>
    I have an assignment for Discrete Maths due in on Monday. I was
organised and mostly completed the assignment in advance. But on the
final question I used an inductive proof, I haven’t shown the base case
because it required some manipulation. I will start this sometime
soon.
   </p>
   <h1>
    22:00 - Slideshow Karaoke
   </h1>
   <p>
    I’ve finished watching Slideshow Karaoke, an awesome event. And I’ve
done my discrete maths as well.
   </p>
   <h1>
    22:15 - Project Structure
   </h1>
   <p>
    I think I will create a file called <code>state</code> to store the
state of the turing machine. To keep things standard, I’ll give the
Turing machine a binary alphabet (0 and 1) and a single tape for input
and output. These choices do not matter for the computational power of
the Turing machine.
   </p>
   <p>
    The <code>state</code> file will contain 3 lines.
   </p>
   <p>
    The first line will contain a sequence of 0s 1s. Initially, the tape
is filled with 0s. These can be stored implictly.
   </p>
   <p>
    The second line will contain a number, this represents the location
of the read-write head on the tape. This number takes on a value from
the natural numbers ((\mathbb N = {0, 1, 2, \dots})).
   </p>
   <p>
    The third line will again contain a number. This number will index
the state that Turing machine is currently in.
   </p>
   <p>
    There will also be a <code>machine</code> file. Each line in this
file will define a state for the turing machine. The first line is the
starting state.
   </p>
   <p>
    Each state-definition will contain 2 sections. The first section
defines the action of the turing machine on input 0. The second section
defines the action of the turing machine on input 1.
   </p>
   <p>
    A section defines what the machine outputs, the direction to move the
read-write head and the state to transition to.
   </p>
   <p>
    As an example I will give a definition for the 3-state busy beaver
champion.
   </p>
   <h2>
    State
   </h2>
   <pre><code>0
0
0</code></pre>
   <h2>
    Machine
   </h2>
   <pre><code>1.R.1,1.L.2
1.L.0,1.R.1
1.L.1,1.L.H</code></pre>
   <p>
    In fact, at the start of computation the state file can be
initialised to three zeros for any turing machine.
   </p>
   <h1>
    22:41 - GitHub actions
   </h1>
   <p>
    I don’t exactly know how GitHub actions work, but that’s ok. I will
learn.
   </p>
   <h1>
    22:43 - Turing machine status
   </h1>
   <p>
    I’ve decided that I’ll create a status file, its value will be
<code>running</code>, <code>halt</code> or <code>start</code>. A commit
that changes the contents of the status file to <code>start</code> will
begin to perform the steps of computation for the Turing machine.
   </p>
   <h1>
    23:59 - Midnight Pizza
   </h1>
   <p>
    I have been rewarded for my efforts with midnight peperoni pizza. I
am happy.
   </p>
   <h1>
    01:10 - It works?
   </h1>
   <p>
    I was able to start the Turing machine and it correctly performed the
first step of computation, but it seems to get stuck and not do anything
afterwards.
   </p>
   <img src="https://i.imgur.com/O4HyJlY.png">
   <p>
    To remedy this, I decided to set up a cron schedule to start the
action every 5 minutes so it can perform the next step of
computation.
   </p>
   <p>
    Will this work? I will find out in 5 minutes.
   </p>
   <h1>
    01:25 - Seemingly no progress
   </h1>
   <p>
    The cron job does not seem to be running. however, I have another
idea. I can run all the commits at once inside the action instead of
running each commit in seperate action runs.
   </p>
   <h1>
    01:36 - Progress
   </h1>
   <p>
    The Turing machine completed <strong>three</strong> (!) steps before
crashing. I am very happy.
<img src="https://i.imgur.com/uw7XDME.png">
   </p>
   <p>
    The error message is not that descriptive, it reads as follows
   </p>
   <pre><code>sed: -e expression #1, char 27: Invalid content of \{\}</code></pre>
   <p>
    I’m able to deduce that the line causing the error is the
following
   </p>
   <div class="sourceCode" id="cb8">
    <pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the character under the read-write head with the output</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># from the state</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="va">NEW_TAPE</span><span class="op">=</span><span class="va">$(</span><span class="bu">echo</span> <span class="va">$TAPE</span> <span class="kw">|</span> <span class="fu">sed</span> <span class="at">-e</span> <span class="st">"s/\(.\)\{</span><span class="va">$((LOCATION))</span><span class="st">\}.\(.*\)/\1</span><span class="va">$OUTPUT</span><span class="st">\2/"</span><span class="va">)</span></span></code></pre>
   </div>
   <p>
    I’ve just noticed the problem. You might be able to notice that in
the above image, the Turing machine moves one to the right. So now it’s
in the second cell. Now it moves one to the left, it is back in the
first cell. It then moves one to the left - it falls off the grid.
   </p>
   <h1>
    01:44 - Definitions
   </h1>
   <p>
    I’ve noticed that the example for the three-state busy beaver
champion uses a two-way infinite tape. Hm. When doing Computer Science
this doesn’t really matter because they are effectively equivalent. But
I am not doing Computer Science right now, I am doing Computer Hackery
and I am using <code>sed</code> to simulate a Turing machine. This
matters a lot.
   </p>
   <h1>
    01:48 - A hack
   </h1>
   <p>
    I can add a hack that goes like this: If the location of the read
write head becomes negative, then I can prepend a character and pretend
that the read-write head is at location 0.
   </p>
   <h1>
    02:06 - It worked too well
   </h1>
   <p>
    So the hack worked - sort of. It worked and kept on going. Then it
just kept on going and going and going. The Turing machine just didn’t
stop. The repository now has 163 commits.
<img src="https://i.imgur.com/7DYzRpX.png">
   </p>
   <h1>
    02:41 - Tired
   </h1>
   <p>
    Oh my god I’m so tired.
   </p>
   <h1>
    03:10 - What have I done
   </h1>
   <p>
    The machine seems to have started itself while I wasn’t paying
attention. The repository is now at 954 commits oh god.
   </p>
   <p>
    Was it that cron schedule I wrote a while back?
<img src="https://i.imgur.com/c3hXB12.png">
   </p>
   <h1>
    03:12
   </h1>
   <p>
    We’ve hit 1,000! I need to turn this off somehow.
<img src="https://i.imgur.com/qqAUSQp.png">
   </p>
   <h1>
    03:31 - It works!
   </h1>
   <p>
    There was some weird and subtle bug with one of my sed rewrite rules.
I fixed the bug and the Turing machine works in its entirety! I present
to you the three-state busy beaver champion, simulated using GitHub
actions and <code>sed</code>.
   </p>
   <img src="https://i.imgur.com/UYsCk5O.png">
   <h1>
    03:59 - The end
   </h1>
   <p>
    So I have about 8 hours left for the Hackathon but I think I’ll
finish here. I’ve had so much fun at Durhack, my first ever Hackathon.
<img src="https://i.imgur.com/lEsx8ih.png">
   </p>
   <h1>
    07:32 - Renewed motivation?
   </h1>
   <p>
    So, I stayed awake just walking around and chatting to people. I feel
like working on Coderly. I have four and a half hours so I’ll see what I
can do.
   </p>
   <h1>
    07:33 - Sample code
   </h1>
   <p>
    Below is the canonical source code I will be testing against. See if
you can find the errors.
   </p>
   <div class="sourceCode" id="cb9">
    <pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Adds five integers</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">[]</span> xs <span class="op">=</span> <span class="op">{-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="op">-</span><span class="dv">5</span><span class="op">};</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">6</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    sum <span class="op">-=</span> ys<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"The product is </span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> sum<span class="op">);</span></span></code></pre>
   </div>
   <h1>
    07:36 - Opening up Google Colab
   </h1>
   <p>
    I’m going to load the 2B parameter model into Google Colab.
   </p>
   <h1>
    07:38 - Things are looking good
   </h1>
   <p>
    The model seems to load in Google Colab. This is god.
   </p>
   <h1>
    08:03 - Good news!
   </h1>
   <p>
    The model does what I want it to do! I’ll try scaling it to the 6BN
model then export the data to process locally.
   </p>
   <h1>
    08:06 - Thank you Google
   </h1>
   <p>
    Google’s beefy servers allow me to download a 15GB model in just 4
minutes.
   </p>
   <h1>
    08:07 - Amending the sample code
   </h1>
   <p>
    I’ve noticed that the model has some implicit bias. It assumes the
language is not C and doesn’t expect to see <code>int[]</code>
   </p>
   <div class="sourceCode" id="cb10">
    <pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// The following C code adds five integers                                                                                   </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">[]</span> xs <span class="op">=</span> <span class="op">{-</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="op">-</span><span class="dv">5</span><span class="op">};</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">6</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    sum <span class="op">-=</span> ys<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"The product is </span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> sum<span class="op">);</span></span></code></pre>
   </div>
   <h1>
    08:11 - Model’s downloaded!
   </h1>
   <p>
    Yay!
   </p>
   <h1>
    08:11 - Colab instance crashed!
   </h1>
   <p>
    So I only have about 12GB RAM available on my Google Colab instance.
The 6B model seems to be too much. Back to 2B I go!
   </p>
   <h1>
    08:16 - Data downloaded!
   </h1>
   <p>
    Hacking time!!
   </p>
   <h1>
    08:53 - The end!
   </h1>
   <p>
    Proof of concept done! Writeup finished. Here’s the final result.
<img src="https://res.cloudinary.com/devpost/image/fetch/s--mj8g2lD9--/c_limit,f_auto,fl_lossy,q_auto:eco,w_900/https://i.imgur.com/L4OqsjV.png">
   </p>
   <h1>
    17:58 - Round up
   </h1>
   <p>
    I’ve had such an amazing time. I was a finalist so I got to
demonstrate my project and I ended up being a runner-up which won me a
shiny new keyboard and QRT also gave me some sweet bottles for which I
am very grateful for.
   </p>
   <p>
    My GitHub actions Turing Machine also won me an award for most
creative use of GitHub. This has been a superb weekend.
   </p>
   <img src="https://i.imgur.com/W0hoorS.jpg" alt="Swag">
  </main>
 </body>
</html>
