<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/blog/pico.min.css">
  <link rel="stylesheet" href="/blog/index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous">
  <script defer="" src="/blog/js/katex.min.js" integrity="sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY" crossorigin="anonymous"></script>
  <script defer="" src="/blog/js/auto-render.min.js" integrity="sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
  <link rel="stylesheet" href="/blog/dracula.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/go.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/fortran.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/cpp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/julia.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/c.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/haskell.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/perl.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/rust.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/highlightjs-lean/dist/lean.min.js"></script>
  <script type="text/javascript" src="https://unpkg.com/highlightjs-lean/dist/r.min.js"></script>
  <script>
   hljs.highlightAll();
  </script>
 </head>
 <body>
  <main>
   <h1>
    Speeding up my bashrc
   </h1>
   <p>
    <strong>26 July 2025</strong>
   </p>
   <hr>
   <p>
    Recently I’ve been having long startup times when booting up a
terminal instance on my laptop. I traced it to a line in my
<code>.bashrc</code>. I first assumed it was the lines initialising my
<a href="https://github.com/mamba-org/mamba">mamba</a> environment but I
timed this and it was fast.
   </p>
   <p>
    I ran <code>time pfetch</code> and noticed it took 3 seconds to run
to completion.
   </p>
   <div class="sourceCode" id="cb1">
    <pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">05:27:37</span> sam@localhost pfetch-caching → time pfetch </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">_____</span>   ______       sam@localhost.localdomain</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> <span class="ex">/</span> ____\ / ____ <span class="dt">\ </span>     os     openSUSE Tumbleweed</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">/</span> /    <span class="kw">`</span><span class="ex">/</span> /    <span class="dt">\ \ </span>    host   2325VZ9 ThinkPad X230</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="ex">\ \____/</span> /,____/ /     kernel 6.15.4-1-default</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a> <span class="ex">\______/</span> <span class="dt">\_</span>____/      uptime 13m</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                       <span class="ex">pkgs</span>   5496</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                       <span class="ex">memory</span> 4381M / 7643M</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">real</span>    0m3.177s</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="ex">user</span>    0m3.076s</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">sys</span>     0m0.152s</span></code></pre>
   </div>
   <p>
    Almost all of this time is due to querying the number of packages on
my system with <code>rpm -qa</code>.
   </p>
   <div class="sourceCode" id="cb2">
    <pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">05:39:06</span> sam@localhost ~ → time rpm <span class="at">-qa</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">5496</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">real</span>    0m3.249s</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">user</span>    0m3.159s</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">sys</span>     0m0.138s</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">05:39:11</span> sam@localhost ~ → </span></code></pre>
   </div>
   <p>
    I <em>need</em> <code>pfetch</code> in my bashrc (everyone else has
it so I need it too) so removing it isn’t an option.
   </p>
   <p>
    I decided to cache the result of pfetch with a cron job that runs
every minute. I initially defined my job like this
   </p>
   <div class="sourceCode" id="cb3">
    <pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> <span class="pp">*</span> <span class="pp">*</span> <span class="pp">*</span> <span class="pp">*</span> pfetch <span class="op">&gt;</span> ~/.pfetch-output</span></code></pre>
   </div>
   <p>
    But then I noticed that the <code>.pfetch-output</code> file it
generated was empty. I guessed it was due to it not finding
<code>pfetch</code> so ran <code>which pfetch</code> to find where it
was located and give cron the absolute path. When I did this I was
surprised by receiving “mail” in <code>/var/mail/sam</code>
   </p>
   <div class="sourceCode" id="cb4">
    <pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">05:25:33</span> sam@localhost pfetch-caching → which pfetch</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/home/sam/.local/bin/pfetch</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span> have mail in /var/mail/sam</span></code></pre>
   </div>
   <p>
    I didn’t actually know I could receive mail like this
   </p>
   <pre><code>05:25:35 sam@localhost pfetch-caching → cat /var/mail/sam 
From sam@localhost  Sat Jul 26 05:25:01 2025
Return-Path: &lt;sam@localhost&gt;
X-Original-To: sam
Delivered-To: sam@localhost
Received: by localhost (Postfix, from userid 1000)
        id 37EC92AF2CC; Sat, 26 Jul 2025 05:25:01 +0100 (BST)
From: "(Cron Daemon)" &lt;sam@localhost&gt;
To: sam@localhost
Subject: Cron &lt;sam@localhost&gt; pfetch &gt; .pfetch-output
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Auto-Submitted: auto-generated
Precedence: bulk
X-Cron-Env: &lt;LANG=en_GB.UTF-8&gt;
X-Cron-Env: &lt;SHELL=/bin/sh&gt;
X-Cron-Env: &lt;HOME=/home/sam&gt;
X-Cron-Env: &lt;PATH=/usr/bin:/bin:/usr/sbin:/sbin&gt;
X-Cron-Env: &lt;LOGNAME=sam&gt;
X-Cron-Env: &lt;USER=sam&gt;
Message-Id: &lt;20250726042501.37EC92AF2CC@localhost&gt;
Date: Sat, 26 Jul 2025 05:25:01 +0100 (BST)

/bin/sh: line 1: pfetch: command not found</code></pre>
   <p>
    Which is what I expected the issue to be and replacing
<code>pfetch</code> with <code>/home/sam/.local/bin/pfetch</code>
produces the right output. I replaced the <code>pfetch</code> call in my
bashrc with <code>cat .pfetch-output</code> and my bashrc takes less
than a year to run which is quite nice.
   </p>
   <p>
    Actually, since the only issue with pfetch was finding the number of
packages on my system, I decided to cache the package list to a file and
modify pfetch so that it read from this file.
   </p>
   <div class="sourceCode" id="cb6">
    <pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">05:51:54</span> sam@localhost pfetch-caching → crontab <span class="at">-l</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> <span class="pp">*</span> <span class="pp">*</span> <span class="pp">*</span> <span class="pp">*</span> rpm <span class="at">-qa</span> <span class="op">&gt;</span> .rpm-qa-output</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="ex">05:51:56</span> sam@localhost pfetch-caching →</span></code></pre>
   </div>
   <p>
    This has the added bonus that when <code>pfetch</code> runs I have an
up-to-date memory usage. As an aside, I learned how to do <a href="https://bauer.codes/post/2025/04/bash-profiling/">line-profiling
of bash scripts</a> which I find kinda funny and feels pretty extra and
unecessary.
   </p>
   <p>
    To be honest, I find this entire fiasco a bit funny.
   </p>
   <h1>
    References
   </h1>
   <p>
    [1]: <a href="https://bauer.codes/post/2025/04/bash-profiling/">https://bauer.codes/post/2025/04/bash-profiling/</a>
   </p>
  </main>
 </body>
</html>
